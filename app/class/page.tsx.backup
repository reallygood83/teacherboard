'use client';

import { useState, useEffect } from "react"
import "../../styles/navigation.css"
import "../../styles/mobile-optimized.css"
import { PerformanceMonitor, usePerformanceMonitor } from '@/components/ui/performance-monitor'
import { mobileUtils } from '@/lib/mobile-utils'
import { DragDropContext, Droppable, Draggable } from '@hello-pangea/dnd'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { Tabs, TabsContent } from "@/components/ui/tabs"
import {
  Clock,
  Calendar,
  Users,
  BookOpen,
  Link,
  Timer,
  Shuffle,
  UserCheck,
  ExternalLink,
  Heart,
  Play,
  SettingsIcon,
  ChevronLeft,
  ChevronRight,
  Plus,
  Trash2,
  Brain,
  FileText,
} from "lucide-react"
import { DigitalClock } from "@/components/digital-clock"
import { Chalkboard } from "@/components/chalkboard"
import { StudentPicker } from "@/components/student-picker"
import { GroupMaker } from "@/components/group-maker"
import { LinkEmbedder } from "@/components/link-embedder"
import { Timetable } from "@/components/timetable"
import { YoutubeSearch } from "@/components/youtube-search"
import { Settings } from "@/components/settings"
// import { OfficialDocGenerator } from "@/components/official-doc-generator"
import { DocumentGenerator } from "@/components/document-generator"
import { ScheduleManager } from "@/components/schedule-manager"
import { useAuth } from "@/contexts/AuthContext"
import { useRouter } from "next/navigation"
import UserProfile from "@/components/auth/UserProfile"

interface SettingsData {
  title: string
  subtitle: string
  footerText: string
  footerSubtext: string
  backgroundMode: string
  geminiApiKey: string
  geminiModel: string
}

interface SavedLink {
  id: string
  title: string
  url: string
  description?: string
  category: string
  addedDate: string
  isQuickLink?: boolean
}

export default function ClassHomepage() {
  const { currentUser, loading } = useAuth();
  const router = useRouter();
  
  const [currentDate, setCurrentDate] = useState("")
  const [isQuickLinksCollapsed, setIsQuickLinksCollapsed] = useState(false)
  const [savedLinks, setSavedLinks] = useState<SavedLink[]>([])
  const [activeTab, setActiveTab] = useState("tools")
  
  // íƒ­ ìˆœì„œ ê´€ë¦¬
  const [tabOrder, setTabOrder] = useState([
    "tools",
    "ai-tools", 
    "schedule",
    "schedule-management",
    "students",
    "youtube",
    "links", 
    "time",
    "settings"
  ])
  
  const [settings, setSettings] = useState<SettingsData>({
    title: "ìš°ë¦¬ í•™ê¸‰ í™ˆí˜ì´ì§€",
    subtitle: "í•¨ê»˜ ë°°ìš°ê³  ì„±ì¥í•˜ëŠ” ê³µê°„ì…ë‹ˆë‹¤ â¤ï¸",
    footerText: "êµìœ¡ì„ ìœ„í•œ ë”°ëœ»í•œ ê¸°ìˆ ",
    footerSubtext: "Â© 2025 ìš°ë¦¬ í•™ê¸‰ í™ˆí˜ì´ì§€. ëª¨ë“  ê¶Œë¦¬ ë³´ìœ .",
    backgroundMode: "green",
    geminiApiKey: "",
    geminiModel: "gemini-1.5-flash",
  })

  // í—¤ë” ì¹´ìš´íŠ¸ë‹¤ìš´ ê´€ë ¨ ìƒíƒœ
  const [selectedImportantEvent, setSelectedImportantEvent] = useState<any | null>(null)
  const [countdownText, setCountdownText] = useState<string>("")
  const [isMobile, setIsMobile] = useState(false)
  
  // Touch gesture handling for mobile
  const [touchStartX, setTouchStartX] = useState<number | null>(null)
  const [touchStartY, setTouchStartY] = useState<number | null>(null)
  
  // ë“œë˜ê·¸ì•¤ë“œë¡­ ì²˜ë¦¬
  const handleTabDragEnd = (result: any) => {
    if (!result.destination) return

    const items = Array.from(tabOrder)
    const [reorderedItem] = items.splice(result.source.index, 1)
    items.splice(result.destination.index, 0, reorderedItem)

    setTabOrder(items)
    // íƒ­ ìˆœì„œë¥¼ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
    localStorage.setItem('tabOrder', JSON.stringify(items))
  }
  
  // Touch gesture handlers for mobile tab navigation
  const handleTouchStart = (e: React.TouchEvent) => {
    if (!isMobile) return
    const touch = e.touches[0]
    setTouchStartX(touch.clientX)
    setTouchStartY(touch.clientY)
  }
  
  const handleTouchMove = (e: React.TouchEvent) => {
    if (!isMobile || touchStartX === null || touchStartY === null) return
    
    const touch = e.touches[0]
    const deltaX = touchStartX - touch.clientX
    const deltaY = touchStartY - touch.clientY
    
    // Only trigger if horizontal swipe is dominant
    if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 50) {
      const currentIndex = tabOrder.indexOf(activeTab)
      
      if (deltaX > 0 && currentIndex < tabOrder.length - 1) {
        // Swipe left - next tab
        setActiveTab(tabOrder[currentIndex + 1])
      } else if (deltaX < 0 && currentIndex > 0) {
        // Swipe right - previous tab
        setActiveTab(tabOrder[currentIndex - 1])
      }
      
      // Reset touch state
      setTouchStartX(null)
      setTouchStartY(null)
    }
  }
  useEffect(() => {
    // ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìëŠ” ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
    if (!loading && !currentUser) {
      router.push('/login');
      return;
    }
  }, [currentUser, loading, router]);

  useEffect(() => {
    const today = new Date()
    const options: Intl.DateTimeFormatOptions = {
      year: "numeric",
      month: "long",
      day: "numeric",
      weekday: "long",
    }
    setCurrentDate(today.toLocaleDateString("ko-KR", options))

    const savedSettings = localStorage.getItem("classHomepageSettings")
    if (savedSettings) {
      setSettings(JSON.parse(savedSettings))
    }

    // ì €ì¥ëœ ë§í¬ ë¶ˆëŸ¬ì˜¤ê¸°
    const savedLinksData = localStorage.getItem("classHomepageLinks")
    if (savedLinksData) {
      setSavedLinks(JSON.parse(savedLinksData))
    }
    
    // ì €ì¥ëœ íƒ­ ìˆœì„œ ë¶ˆëŸ¬ì˜¤ê¸°
    const savedTabOrder = localStorage.getItem("tabOrder")
    if (savedTabOrder) {
      setTabOrder(JSON.parse(savedTabOrder))
    }

    // ëª¨ë°”ì¼ ê°ì§€ ë° ì„±ëŠ¥ ìµœì í™”
    const checkIsMobile = () => {
      const isMobileDevice = mobileUtils.device.isMobile() || window.innerWidth < 768
      setIsMobile(isMobileDevice)
    }
    
    checkIsMobile()
    window.addEventListener('resize', checkIsMobile)
    
    // ëª¨ë°”ì¼ ì„±ëŠ¥ ìµœì í™” ì„¤ì •
    if (mobileUtils.device.isMobile()) {
      // ë™ì  ë·°í¬íŠ¸ ë†’ì´ ì„¤ì •
      mobileUtils.viewport.setDynamicViewportHeight()
      
      // ì¤‘ìš” ë¦¬ì†ŒìŠ¤ í”„ë¦¬ë¡œë“œ
      mobileUtils.performance.preloadCriticalResources()
      
      // ë„¤íŠ¸ì›Œí¬ ìƒíƒœì— ë”°ë¥¸ ì ì‘
      const networkSpeed = mobileUtils.network.adaptToNetworkSpeed()
      console.log('Network speed detected:', networkSpeed)
    }
    
    return () => {
      window.removeEventListener('resize', checkIsMobile)
    }
  }, [])

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen bg-gray-100">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto mb-4"></div>
          <p className="text-gray-600">ë¡œë”© ì¤‘...</p>
        </div>
      </div>
    );
  }

  if (!currentUser) {
    return null; // useEffectì—ì„œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì²˜ë¦¬
  }

  const handleSettingsChange = (newSettings: SettingsData) => {
    setSettings(newSettings)
  }

  // ë¹ ë¥¸ë§í¬ì—ì„œ ë§í¬ ì œê±° (ë¹ ë¥¸ ë§í¬ ìƒíƒœë§Œ í•´ì œ)
  const removeQuickLink = (id: string) => {
    const updatedLinks = savedLinks.map((link) => {
      if (link.id === id) {
        return { ...link, isQuickLink: false }
      }
      return link
    })
    setSavedLinks(updatedLinks)
    localStorage.setItem("classHomepageLinks", JSON.stringify(updatedLinks))
  }

  // ë§í¬ ì—´ê¸°
  const openLink = (url: string) => {
    window.open(url, "_blank")
  }

  const getBackgroundClass = () => {
    switch (settings.backgroundMode) {
      case "blue":
        return "bg-blue-50"
      case "purple":
        return "bg-purple-50"
      case "orange":
        return "bg-orange-50"
      case "pink":
        return "bg-pink-50"
      case "gray":
        return "bg-gray-50"
      default:
        return "bg-green-50"
    }
  }

  const getGradientClass = () => {
    switch (settings.backgroundMode) {
      case "blue":
        return "bg-gradient-to-r from-blue-600 to-blue-700"
      case "purple":
        return "bg-gradient-to-r from-purple-600 to-purple-700"
      case "orange":
        return "bg-gradient-to-r from-orange-600 to-orange-700"
      case "pink":
        return "bg-gradient-to-r from-pink-600 to-pink-700"
      case "gray":
        return "bg-gradient-to-r from-gray-600 to-gray-700"
      default:
        return "educational-gradient"
    }
  }

  const getAccentColor = () => {
    switch (settings.backgroundMode) {
      case "blue":
        return "text-blue-600"
      case "purple":
        return "text-purple-600"
      case "orange":
        return "text-orange-600"
      case "pink":
        return "text-pink-600"
      case "gray":
        return "text-gray-600"
      default:
        return "text-green-600"
    }
  }

  // íƒ­ ì •ë³´ ì •ì˜
  const tabsInfo = {
    "tools": { icon: BookOpen, label: "ìˆ˜ì—… ë„êµ¬", shortLabel: "ìˆ˜ì—…" },
    "ai-tools": { icon: Brain, label: "AI ë„êµ¬", shortLabel: "AI" },
    "schedule": { icon: Calendar, label: "ì‹œê°„í‘œ", shortLabel: "ì‹œê°„í‘œ" },
    "schedule-management": { icon: Calendar, label: "ì¼ì • ê´€ë¦¬", shortLabel: "ì¼ì •" },
    "students": { icon: Users, label: "í•™ìƒ ê´€ë¦¬", shortLabel: "í•™ìƒ" },
    "youtube": { icon: Play, label: "YouTube", shortLabel: "ë™ì˜ìƒ" },
    "links": { icon: Link, label: "ì™¸ë¶€ ë§í¬", shortLabel: "ë§í¬" },
    "time": { icon: Clock, label: "ì‹œê°„ ê´€ë¦¬", shortLabel: "ì‹œê°„" },
    "settings": { icon: SettingsIcon, label: "ì„¤ì •", shortLabel: "ì„¤ì •" }
  };

  return (
    <div className="mobile-layout bg-green-50">
      <div>ë¹Œë“œ í…ŒìŠ¤íŠ¸</div>
    </div>
  );
          </div>
          <div className="flex items-center gap-2">
            <div className="text-right hidden sm:block">
              <p className="text-white text-opacity-90 text-xs">ì˜¤ëŠ˜ì€</p>
              <p className="font-semibold text-sm">{currentDate.split(' ').slice(0, 2).join(' ')}</p>
              {countdownText && (
                <p className="text-yellow-200 text-xs mt-1 truncate max-w-[140px]">
                  {countdownText}
                </p>
              )}
            </div>
            <UserProfile />
          </div>
        </div>
      </header>

      {/* Welcome Message - Mobile Optimized */}
      <div className="mobile-container">
        <div className="mb-4 text-center px-2">
          <p className="text-gray-600 text-sm sm:text-base">
            ì•ˆë…•í•˜ì„¸ìš” {currentUser.displayName}ë‹˜ â¤ï¸
          </p>
          <p className="text-gray-500 text-xs sm:hidden mt-1">{currentDate}</p>
        </div>
      </div>

      {/* Main Content */}
      <main 
        className="mobile-container"
        onTouchStart={handleTouchStart}
        onTouchMove={handleTouchMove}
      >

        <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full">
          {/* ê°œì„ ëœ ë„¤ë¹„ê²Œì´ì…˜ */}
          <DragDropContext onDragEnd={handleTabDragEnd}>
            <div className="mb-8">
              {/* ë°ìŠ¤í¬í†± ë„¤ë¹„ê²Œì´ì…˜ */}
              <div className="hidden lg:block">
                <Droppable droppableId="tabs" direction="horizontal">
                  {(provided, snapshot) => (
                    <div
                      {...provided.droppableProps}
                      ref={provided.innerRef}
                      className={`flex flex-wrap gap-2 justify-center bg-muted p-2 rounded-lg droppable-area ${
                        snapshot.isDraggingOver ? "is-dragging-over" : ""
                      }`}
                    >
                      {tabOrder.map((tabKey, index) => (
                        <Draggable key={tabKey} draggableId={tabKey} index={index}>
                          {(provided, snapshot) => {
                            const tabInfo = tabsInfo[tabKey as keyof typeof tabsInfo]
                            const IconComponent = tabInfo.icon
                            return (
                              <div
                                ref={provided.innerRef}
                                {...provided.draggableProps}
                                {...provided.dragHandleProps}
                                className={`px-4 py-2 rounded-md text-sm font-medium transition-all duration-200 cursor-move flex items-center gap-2 draggable-tab ${
                                  activeTab === tabKey
                                    ? "bg-background text-foreground shadow-md"
                                    : "text-muted-foreground hover:text-foreground hover:bg-background/50"
                                } ${snapshot.isDragging ? "is-dragging" : ""}`}
                                onClick={() => setActiveTab(tabKey)}
                                role="tab"
                                aria-selected={activeTab === tabKey}
                                tabIndex={0}
                                onKeyDown={(e) => {
                                  if (e.key === 'Enter' || e.key === ' ') {
                                    setActiveTab(tabKey)
                                  }
                                }}
                              >
                                <IconComponent className="w-4 h-4" />
                                <span className="whitespace-nowrap">{tabInfo.label}</span>
                              </div>
                            )
                          }}
                        </Draggable>
                      ))}
                      {provided.placeholder}
                    </div>
                  )}
                </Droppable>
              </div>

              {/* íƒœë¸”ë¦¿ ë„¤ë¹„ê²Œì´ì…˜ (ì¤‘ê°„ í™”ë©´) */}
              <div className="hidden md:block lg:hidden">
                <Droppable droppableId="tabs-tablet" direction="horizontal">
                  {(provided, snapshot) => (
                    <div
                      {...provided.droppableProps}
                      ref={provided.innerRef}
                      className={`grid grid-cols-5 gap-2 bg-muted p-2 rounded-lg tablet-nav-grid droppable-area ${
                        snapshot.isDraggingOver ? "is-dragging-over" : ""
                      }`}
                    >
                      {tabOrder.map((tabKey, index) => (
                        <Draggable key={tabKey} draggableId={tabKey} index={index}>
                          {(provided, snapshot) => {
                            const tabInfo = tabsInfo[tabKey as keyof typeof tabsInfo]
                            const IconComponent = tabInfo.icon
                            return (
                              <div
                                ref={provided.innerRef}
                                {...provided.draggableProps}
                                {...provided.dragHandleProps}
                                className={`px-2 py-2 rounded-md text-xs font-medium transition-all duration-200 cursor-move flex flex-col items-center gap-1 draggable-tab ${
                                  activeTab === tabKey
                                    ? "bg-background text-foreground shadow-md"
                                    : "text-muted-foreground hover:text-foreground hover:bg-background/50"
                                } ${snapshot.isDragging ? "is-dragging" : ""}`}
                                onClick={() => setActiveTab(tabKey)}
                                role="tab"
                                aria-selected={activeTab === tabKey}
                                tabIndex={0}
                                onKeyDown={(e) => {
                                  if (e.key === 'Enter' || e.key === ' ') {
                                    setActiveTab(tabKey)
                                  }
                                }}
                              >
                                <IconComponent className="w-4 h-4" />
                                <span className="text-center leading-tight">{tabInfo.shortLabel}</span>
                              </div>
                            )
                          }}
                        </Draggable>
                      ))}
                      {provided.placeholder}
                    </div>
                  )}
                </Droppable>
              </div>

              {/* ëª¨ë°”ì¼ ë„¤ë¹„ê²Œì´ì…˜ (ë“œë¡­ë‹¤ìš´ í˜•íƒœ) */}
              <div className="block md:hidden">
                <div className="bg-muted p-2 rounded-lg">
                  <select
                    value={activeTab}
                    onChange={(e) => setActiveTab(e.target.value)}
                    className="w-full p-3 rounded-md bg-background border border-border text-sm font-medium mobile-nav-select"
                    aria-label="ë„¤ë¹„ê²Œì´ì…˜ ì„¹ì…˜ ì„ íƒ"
                  >
                    {tabOrder.map((tabKey) => {
                      const tabInfo = tabsInfo[tabKey as keyof typeof tabsInfo]
                      return (
                        <option key={tabKey} value={tabKey}>
                          {tabInfo.label}
                        </option>
                      )
                    })}
                  </select>
                </div>
              </div>
            </div>
          </DragDropContext>
          
          {/* ë“œë˜ê·¸ì•¤ë“œë¡­ ë„ì›€ë§ */}
          <div className="hidden lg:block mb-4">
            <p className="text-xs text-muted-foreground text-center">
              ğŸ’¡ íƒ­ì„ ë“œë˜ê·¸í•´ì„œ ìˆœì„œë¥¼ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
            </p>
          </div>

          {/* ìˆ˜ì—… ë„êµ¬ íƒ­ - ëª¨ë°”ì¼ ìµœì í™” */}
          <TabsContent value="tools" className="mobile-grid">
            {/* ìˆ˜ì—… ì¹ íŒ - ëª¨ë°”ì¼ì—ì„œ ì „ì²´ ë„ˆë¹„ */}
            <div className="card-mobile">
              <div className="card-mobile-header">
                <h3 className="card-mobile-title">
                  <BookOpen className="mobile-icon text-green-600" />
                  ìˆ˜ì—… ì¹ íŒ
                </h3>
                <p className="card-mobile-description">
                  ìˆ˜ì—… ì¤‘ í•„ìš”í•œ ë‚´ìš©ì„ ììœ ë¡­ê²Œ ì‘ì„±í•˜ê³  í¸ì§‘í•˜ì„¸ìš”
                </p>
              </div>
              <div className="card-mobile-content">
                <Chalkboard 
                  geminiApiKey={settings.geminiApiKey}
                  geminiModel={settings.geminiModel}
                />
              </div>
            </div>

            {/* ë¹ ë¥¸ ë§í¬ - ëª¨ë°”ì¼ ìµœì í™” */}
            {!isQuickLinksCollapsed && (
              <div className="card-mobile">
                <div className="card-mobile-header">
                  <div className="flex items-center justify-between">
                    <h3 className="card-mobile-title">
                      <ExternalLink className="mobile-icon text-green-600" />
                      ë¹ ë¥¸ ë§í¬
                    </h3>
                    <Button 
                      variant="ghost" 
                      size="sm"
                      onClick={() => setIsQuickLinksCollapsed(true)}
                      className="btn-mobile-icon btn-mobile-sm"
                      aria-label="ë¹ ë¥¸ ë§í¬ ì ‘ê¸°"
                    >
                      <ChevronRight className="mobile-icon-sm" />
                    </Button>
                  </div>
                  <p className="card-mobile-description">ìì£¼ ì‚¬ìš©í•˜ëŠ” êµìœ¡ ì‚¬ì´íŠ¸ì— ë¹ ë¥´ê²Œ ì ‘ì†í•˜ì„¸ìš”</p>
                </div>
                <div className="card-mobile-content">
                  {/* ìƒˆ ë§í¬ ì¶”ê°€ ë²„íŠ¼ */}
                  <Button
                    variant="outline"
                    className="btn-mobile w-full mb-4 bg-blue-50 border-blue-200 text-blue-700 hover:bg-blue-100"
                    onClick={() => setActiveTab("links")}
                  >
                    <Plus className="mobile-icon-sm" />
                    ìƒˆ ë§í¬ ì¶”ê°€
                  </Button>
                  
                  {/* ë§í¬ ì¶”ê°€ ì•ˆë‚´ */}
                  {savedLinks.filter(link => link.isQuickLink).length === 0 && (
                    <div className="text-center py-6 text-gray-500">
                      <p className="mb-2 text-sm">ë¹ ë¥¸ ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                      <p className="text-xs">ì™¸ë¶€ ë§í¬ íƒ­ì—ì„œ â­ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë¹ ë¥¸ ë§í¬ë¡œ ì¶”ê°€í•˜ì„¸ìš”</p>
                    </div>
                  )}

                  {/* ë¹ ë¥¸ ë§í¬ë“¤ë§Œ í‘œì‹œ */}
                  <div className="space-y-3 mobile-scroll-area" style={{maxHeight: '300px'}}>
                    {savedLinks.filter(link => link.isQuickLink).slice(0, 8).map((link: SavedLink) => (
                      <div key={link.id} className="swipeable-card haptic-light">
                        <div className="swipeable-card-content">
                          <div className="flex items-center justify-between">
                            <Button
                              variant="ghost"
                              className="flex-1 justify-start text-left p-3 h-auto font-medium"
                              onClick={() => openLink(link.url)}
                              title={link.description || link.url}
                            >
                              <ExternalLink className="mobile-icon-sm mr-3 text-gray-400" />
                              <span className="truncate">{link.title}</span>
                            </Button>
                            <Button
                              size="sm"
                              variant="ghost"
                              className="btn-mobile-icon btn-mobile-sm hover:bg-red-100 hover:text-red-600"
                              onClick={(e) => {
                                e.stopPropagation()
                                removeQuickLink(link.id)
                              }}
                              title="ë§í¬ ì œê±°"
                              aria-label="ë§í¬ ì œê±°"
                            >
                              <Trash2 className="mobile-icon-sm" />
                            </Button>
                          </div>
                        </div>
                        <div className="swipeable-card-actions">
                          <Trash2 className="mobile-icon text-white" />
                        </div>
                      </div>
                    ))}
                  </div>

                  {/* ë¹ ë¥¸ ë§í¬ê°€ 8ê°œ ì´ìƒì¼ ë•Œ ì•ˆë‚´ */}
                  {savedLinks.filter(link => link.isQuickLink).length > 8 && (
                    <p className="text-xs text-gray-500 text-center pt-3">
                      {savedLinks.filter(link => link.isQuickLink).length}ê°œ ì¤‘ 8ê°œ í‘œì‹œ ì¤‘ (ì™¸ë¶€ ë§í¬ íƒ­ì—ì„œ ì „ì²´ ë³´ê¸°)
                    </p>
                  )}
                </div>
              </div>
            )}

            {/* ì ‘íŒ ìƒíƒœì—ì„œ í¼ì¹˜ê¸° ë²„íŠ¼ */}
            {isQuickLinksCollapsed && (
              <div className="card-mobile">
                <div className="card-mobile-content text-center">
                  <Button 
                    variant="outline" 
                    className="btn-mobile-icon"
                    onClick={() => setIsQuickLinksCollapsed(false)}
                    title="ë¹ ë¥¸ ë§í¬ í¼ì¹˜ê¸°"
                    aria-label="ë¹ ë¥¸ ë§í¬ í¼ì¹˜ê¸°"
                  >
                    <ChevronLeft className="mobile-icon" />
                  </Button>
                  <p className="text-xs text-gray-500 mt-2">ë¹ ë¥¸ ë§í¬ í¼ì¹˜ê¸°</p>
                </div>
              </div>
            )}
            </div>
          </TabsContent>

          {/* AI ë„êµ¬ íƒ­ - ëª¨ë°”ì¼ ìµœì í™” */}
          <TabsContent value="ai-tools" className="mobile-grid">
            {/* ê³µë¬¸ ìƒì„±ê¸° */}
            <div className="card-mobile">
              <div className="card-mobile-header">
                <h3 className="card-mobile-title">
                  <FileText className={`mobile-icon ${getAccentColor()}`} />
                  ê³µë¬¸ ìƒì„±ê¸°
                </h3>
                <p className="card-mobile-description">
                  AIê°€ í•œêµ­ ê³µë¬¸ì„œ í‘œì¤€ í˜•ì‹ì— ë§ëŠ” ê³µë¬¸ì„ ìë™ìœ¼ë¡œ ì‘ì„±í•´ë“œë¦½ë‹ˆë‹¤
                </p>
              </div>
              <div className="card-mobile-content">
                <DocumentGenerator 
                  geminiApiKey={settings.geminiApiKey}
                  geminiModel={settings.geminiModel}
                />
              </div>
            </div>

            {/* ì¶”ê°€ AI ë„êµ¬ ì¸ë„¤ì¼ (í–¥í›„ í™•ì¥ìš©) */}
            <div className="card-mobile opacity-60">
              <div className="card-mobile-header">
                <h3 className="card-mobile-title text-gray-500">
                  <Brain className="mobile-icon text-gray-400" />
                  ìˆ˜ì—… ê³„íšì„œ ìƒì„±ê¸°
                </h3>
                <p className="card-mobile-description text-gray-400">
                  ê³§ ì¶œì‹œ ì˜ˆì • - AIê°€ êµìœ¡ê³¼ì •ì— ë§ëŠ” ìˆ˜ì—… ê³„íšì„œë¥¼ ìë™ ì‘ì„±
                </p>
              </div>
              <div className="card-mobile-content">
                <div className="text-center py-8 text-gray-400">
                  <Brain className="w-12 h-12 mx-auto mb-2 opacity-50" />
                  <p className="text-sm">ê°œë°œì¤‘...</p>
                </div>
              </div>
            </div>

            <div className="card-mobile opacity-60">
              <div className="card-mobile-header">
                <h3 className="card-mobile-title text-gray-500">
                  <Brain className="mobile-icon text-gray-400" />
                  í•™ìƒ í‰ê°€ì„œ ìƒì„±ê¸°
                </h3>
                <p className="card-mobile-description text-gray-400">
                  ê³§ ì¶œì‹œ ì˜ˆì • - í•™ìƒë³„ ë§ì¶¤í˜• í‰ê°€ì„œ ë° ìƒí™œê¸°ë¡ë¶€ ì‘ì„± ì§€ì›
                </p>
              </div>
              <div className="card-mobile-content">
                <div className="text-center py-8 text-gray-400">
                  <Brain className="w-12 h-12 mx-auto mb-2 opacity-50" />
                  <p className="text-sm">ê°œë°œì¤‘...</p>
                </div>
              </div>
            </div>

            {/* AI ë„êµ¬ ì•ˆë‚´ */}
            <div className="card-mobile bg-blue-50 border-blue-200">
              <div className="card-mobile-content">
                <div className="flex items-start gap-3">
                  <Brain className="w-6 h-6 text-blue-600 mt-1 flex-shrink-0" />
                  <div>
                    <h3 className="font-semibold text-blue-900 mb-2">AI ë„êµ¬ ì‚¬ìš© ì•ˆë‚´</h3>
                    <ul className="text-sm text-blue-800 space-y-1">
                      <li>â€¢ ì„¤ì • íƒ­ì—ì„œ Gemini API í‚¤ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”</li>
                      <li>â€¢ ìƒì„±ëœ ë¬¸ì„œëŠ” ë°˜ë“œì‹œ ê²€í†  í›„ ì‚¬ìš©í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤</li>
                      <li>â€¢ ê°œì¸ì •ë³´ê°€ í¬í•¨ëœ ë‚´ìš©ì€ ì‹ ì¤‘íˆ ì²˜ë¦¬í•´ì£¼ì„¸ìš”</li>
                      <li>â€¢ ë” ë§ì€ AI ë„êµ¬ê°€ ì§€ì†ì ìœ¼ë¡œ ì¶”ê°€ë  ì˜ˆì •ì…ë‹ˆë‹¤</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </TabsContent>

          {/* ì‹œê°„í‘œ íƒ­ - ëª¨ë°”ì¼ ìµœì í™” */}
          <TabsContent value="schedule" className="mobile-grid">
            <div className="card-mobile">
              <div className="card-mobile-header">
                <h3 className="card-mobile-title">
                  <Calendar className={`mobile-icon ${getAccentColor()}`} />
                  ì˜¤ëŠ˜ì˜ ì‹œê°„í‘œ
                </h3>
                <p className="card-mobile-description">ì˜¤ëŠ˜ì˜ ìˆ˜ì—… ì¼ì •ì„ í™•ì¸í•˜ê³  ê´€ë¦¬í•˜ì„¸ìš”</p>
              </div>
              <div className="card-mobile-content">
                <Timetable />
              </div>
            </div>
          </TabsContent>

          {/* ì¼ì • ê´€ë¦¬ íƒ­ - ëª¨ë°”ì¼ ìµœì í™” */}
          <TabsContent value="schedule-management" className="mobile-grid">
            <div className="card-mobile">
              <div className="card-mobile-header">
                <h3 className="card-mobile-title">
                  <Calendar className={`mobile-icon ${getAccentColor()}`} />
                  ì¼ì • ê´€ë¦¬
                </h3>
                <p className="card-mobile-description">ë°©í•™, í•™êµí–‰ì‚¬, ê°œì¸ ì¼ì • ë“±ì„ í•˜ë£¨/ì£¼ê°„/ì›”ê°„/ì—°ê°„ìœ¼ë¡œ ê´€ë¦¬í•˜ì„¸ìš”</p>
              </div>
              <div className="card-mobile-content">
                <ScheduleManager onEventSelect={(event: any | null) => {
                  if (event && event.isImportant) {
                    setSelectedImportantEvent(event)
                  } else {
                    setSelectedImportantEvent(null)
                  }
                }} />
              </div>
            </div>
          </TabsContent>

          {/* í•™ìƒ ê´€ë¦¬ íƒ­ */}
          <TabsContent value="students" className="mobile-grid">
            <div className="card-mobile">
              <div className="card-mobile-header">
                <h3 className="card-mobile-title">
                  <UserCheck className={`mobile-icon ${getAccentColor()}`} />
                  í•™ìƒ ë½‘ê¸°
                </h3>
                <p className="card-mobile-description">ëœë¤ìœ¼ë¡œ í•™ìƒì„ ì„ íƒí•˜ì—¬ ë°œí‘œë‚˜ í™œë™ì— ì°¸ì—¬ì‹œí‚¤ì„¸ìš”</p>
              </div>
              <div className="card-mobile-content">
                <StudentPicker />
              </div>
            </div>

            <div className="card-mobile">
              <div className="card-mobile-header">
                <h3 className="card-mobile-title">
                  <Shuffle className={`mobile-icon ${getAccentColor()}`} />
                  ëª¨ë‘  í¸ì„±
                </h3>
                <p className="card-mobile-description">í•™ìƒë“¤ì„ ê· ë“±í•˜ê²Œ ëª¨ë‘ ìœ¼ë¡œ ë‚˜ëˆ„ì–´ í˜‘ë ¥ í•™ìŠµì„ ì§„í–‰í•˜ì„¸ìš”</p>
              </div>
              <div className="card-mobile-content">
                <GroupMaker />
              </div>
            </div>
          </TabsContent>

          <TabsContent value="youtube" className="mobile-grid">
            <div className="card-mobile">
              <div className="card-mobile-header">
                <h3 className="card-mobile-title">
                  <Play className="mobile-icon text-red-600" />
                  YouTube êµìœ¡ ë™ì˜ìƒ
                </h3>
                <p className="card-mobile-description">êµìœ¡ìš© YouTube ë™ì˜ìƒì„ ê²€ìƒ‰í•˜ê³  ìˆ˜ì—…ì— í™œìš©í•˜ì„¸ìš”</p>
              </div>
              <div className="card-mobile-content">
                <YoutubeSearch />
              </div>
            </div>
          </TabsContent>

          {/* ì™¸ë¶€ ë§í¬ íƒ­ - ëª¨ë°”ì¼ ìµœì í™” */}
          <TabsContent value="links" className="mobile-grid">
            <div className="card-mobile">
              <div className="card-mobile-header">
                <h3 className="card-mobile-title">
                  <Link className={`mobile-icon ${getAccentColor()}`} />
                  ì™¸ë¶€ ì‚¬ì´íŠ¸ ì„ë² ë”©
                </h3>
                <p className="card-mobile-description">ìœ ìš©í•œ ì™¸ë¶€ ì‚¬ì´íŠ¸ë¥¼ ì‰½ê²Œ ë§í¬í•˜ê³  ì„ë² ë“œí•˜ì„¸ìš”</p>
              </div>
              <div className="card-mobile-content">
                <LinkEmbedder onLinksUpdate={setSavedLinks} />
              </div>
            </div>
          </TabsContent>

          {/* ì‹œê°„ ê´€ë¦¬ íƒ­ - ëª¨ë°”ì¼ ìµœì í™” */}
          <TabsContent value="time" className="mobile-grid">
            <div className="card-mobile">
              <div className="card-mobile-header">
                <h3 className="card-mobile-title">
                  <Timer className={`mobile-icon ${getAccentColor()}`} />
                  ì‹œê°„ ê´€ë¦¬
                </h3>
                <p className="card-mobile-description">í˜„ì¬ ì‹œê°„ì„ í™•ì¸í•˜ê³  ìˆ˜ì—… íƒ€ì´ë¨¸ë¥¼ í™œìš©í•˜ì„¸ìš”</p>
              </div>
              <div className="card-mobile-content">
                <DigitalClock />
              </div>
            </div>
          </TabsContent>



          <TabsContent value="settings" className="mobile-grid">
            <div className="card-mobile">
              <div className="card-mobile-content">
                <Settings onSettingsChange={handleSettingsChange} />
              </div>
            </div>
          </TabsContent>
        </Tabs>
      </main>

      {/* Mobile Bottom Navigation */}
      {isMobile && (
        <nav className="mobile-bottom-nav">
          <div className="mobile-bottom-nav-container">
            {tabOrder.slice(0, 4).map((tabKey) => {
              const tabInfo = tabsInfo[tabKey as keyof typeof tabsInfo]
              const IconComponent = tabInfo.icon
              return (
                <div
                  key={tabKey}
                  className={`mobile-bottom-nav-item ${activeTab === tabKey ? 'active' : ''} haptic-light`}
                  onClick={() => setActiveTab(tabKey)}
                >
                  <IconComponent className="mobile-bottom-nav-icon" />
                  <span className="mobile-bottom-nav-label">{tabInfo.shortLabel}</span>
                </div>
              )
            })}
            {/* More navigation - 5+ íƒ­ì„ ìœ„í•œ ë”ë³´ê¸° ë²„íŠ¼ */}
            <div 
              className={`mobile-bottom-nav-item haptic-light`}
              onClick={() => {
                // Cycle through remaining tabs
                const currentIndex = tabOrder.indexOf(activeTab)
                const remainingTabs = tabOrder.slice(4)
                if (remainingTabs.length > 0) {
                  if (remainingTabs.includes(activeTab)) {
                    const currentRemainingIndex = remainingTabs.indexOf(activeTab)
                    const nextIndex = (currentRemainingIndex + 1) % remainingTabs.length
                    setActiveTab(remainingTabs[nextIndex])
                  } else {
                    setActiveTab(remainingTabs[0])
                  }
                }
              }}
            >
              <div className="mobile-bottom-nav-icon relative">
                {tabOrder.slice(4).includes(activeTab) ? (
                  // Show active tab's icon if in "more" section
                  (() => {
                    const activeTabInfo = tabsInfo[activeTab as keyof typeof tabsInfo]
                    const ActiveIcon = activeTabInfo.icon
                    return <ActiveIcon className="w-full h-full" />
                  })()
                ) : (
                  // Show dots for "more" indicator
                  <div className="flex justify-center items-center w-full h-full">
                    <div className="grid grid-cols-2 gap-1">
                      <div className="w-1 h-1 rounded-full bg-current opacity-60"></div>
                      <div className="w-1 h-1 rounded-full bg-current opacity-60"></div>
                      <div className="w-1 h-1 rounded-full bg-current opacity-60"></div>
                      <div className="w-1 h-1 rounded-full bg-current opacity-60"></div>
                    </div>
                  </div>
                )}
              </div>
              <span className="mobile-bottom-nav-label">
                {tabOrder.slice(4).includes(activeTab) 
                  ? tabsInfo[activeTab as keyof typeof tabsInfo].shortLabel
                  : "ë”ë³´ê¸°"
                }
              </span>
            </div>
          </div>
          
          {/* Swipe indicator for mobile */}
          <div className="absolute top-1 left-1/2 transform -translate-x-1/2">
            <div className="w-8 h-1 bg-gray-300 rounded-full opacity-50"></div>
          </div>
        </nav>
      )}

      {/* Footer - Only show on desktop */}
      {!isMobile && (
        <footer className="bg-white border-t border-green-200 py-8 px-4 mt-16">
          <div className="max-w-7xl mx-auto text-center">
            <p className="text-gray-600 mb-2">
              <Heart className="w-4 h-4 inline text-red-500 mr-1" />
              {settings.footerText}
            </p>
            <p className="text-sm text-gray-500">{settings.footerSubtext}</p>
          </div>
        </footer>
      )}
      
      {/* Performance monitoring component */}
      <PerformanceMonitor />
    </div>
  )
}

// Add performance monitoring hook
function ClassPageContent() {
  usePerformanceMonitor('ClassPage');
  
  return null;
}